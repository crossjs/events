<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>events</title>
<link rel="stylesheet" href="../vendor/qunit/qunit.css">
</head>
<body>
  <h1 id="qunit-header">QUnit Test Suite</h1>
  <h2 id="qunit-banner"></h2>
  <div id="qunit-testrunner-toolbar"></div>
  <h2 id="qunit-userAgent"></h2>
  <ol id="qunit-tests"></ol>
  <div id="qunit-fixture">test markup</div>
  <script src="../vendor/jquery/jquery.js"></script>
  <script src="../vendor/seajs/sea.js"></script>
  <script src="../vendor/qunit/qunit.js"></script>
  <script>
    QUnit.config.autostart = false;

    seajs.config({
      'base': '../sea-modules/',
      'map': [
        ['/sea-modules/jquery', '/vendor/jquery/jquery']
      ],
      'alias': {
        '$': 'jquery'
      }
    });

    seajs.use(['../src/events'], function (Events) {

      'use strict';

      QUnit.start();

      test('new', function() {
        notEqual( new Events(), new Events(), '' );
      });

      test('context', function() {
        var events = new Events(),
          T = '';
        events.on({
          'test': function () {
            equal( this, events, '' );
          }
        });
        events.fire('test');
      });

      test('arguments', function() {
        var events = new Events();
        events.on({
          'test': function (e) {
            deepEqual( Array.prototype.slice.call(arguments),
              [{type: 'test'}, 1, 2, 3], '' );
          }
        });
        events.fire('test', 1, 2, 3);
      });

      test('on(event, callback)', function() {
        var events = new Events();
        events
          .on('test', function (e, a) {
            equal( a, 1, '' );
          })
          .on('test2 test3', function (e, a) {
            equal( a, 2, '' );
          });
        events.fire('test', 1);
        events.fire('test2', 2);
        events.fire('test3', 2);
      });

      test('on(\'all\', callback)', function() {
        var events = new Events(), i = 0;
        events
          .on('all', function (e, a) {
            equal( a, ++i, '' );
          });
        events.fire('test', 1);
        events.fire('test2', 2);
        events.fire('test3', 3);
      });

      test('on(object)', function() {
        var events = new Events();
        events
          .on({
            'test': function (e, a) {
              equal( a, 1, '' );
            }
          }).on({
            'test test2': function (e, a) {
              equal( a, 1, '' );
            }
          });
        events.fire('test', 1);
        events.fire('test2', 1);
      });

      test('off(event)', function() {
        var events = new Events();
        events
          .on('test', function (e, a) {
            this.a = a;
          });
        events.fire('test', 1);
        events.off('test');
        events.fire('test', 2);
        equal( events.a, 1, '' );
      });

      test('off(event, callback)', function() {
        var events = new Events(),
          a = function (e, a) {
            this.a = a;
          },
          a2 = function (e, a) {
            this.a = a + a;
          },
          a3 = function (e, a) {
            this.a = a + a + a;
          };
        events
          .on('test', a)
          .on('test', a2)
          .on('test3', a3);
        events.fire('test', 1);
        equal( events.a, 2, '' );
        events.off('test', a2);
        events.fire('test', 1);
        equal( events.a, 1, '' );
        events.fire('test3', 1);
        equal( events.a, 3, '' );
        events.off('test test3');
        events.fire('test3', 0);
        equal( events.a, 3, '' );
        events.fire('test', 0);
        equal( events.a, 3, '' );
      });

      test('off()', function() {
        var events = new Events();
        events
          .on('test', function (e, a) {
            this.a = a;
          });
        events.fire('test', 1);
        events.off();
        events.fire('test', 2);
        equal( events.a, 1, '' );
      });

      test('off()', function() {
        var events = new Events();
        events.off();
        events.on('test', function () { });
        events.off('test2');
        ok( true, '' );
      });

      test('fire(event)', function() {
        var events = new Events();
        events.fire('test');
        events
          .on('test', function () {
            ok( true, '' );
          })
          .on('test2', function () {
            ok( true, '' );
          });
        events.fire('test');
        events.fire('test test2');
        events.fire('test3');
      });

      test('fire(event)', function() {
        var events = new Events();
        events
          .on('test', function () {
            return true;
          })
          .on('test', function () {
            return false;
          })
          .on('test2', function () {
            return 1;
          })
          .on('test2', function () {
            return 0;
          });
        equal( events.fire('test'), false, '' );
        equal( events.fire('test2'), undefined, '' );
      });

    });
  </script>
</body>
</html>
